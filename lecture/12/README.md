
# 繰り返し

すべての筋をチェックするプログラムが，同じようなことの繰り返しでできている。このようなプログラムを書く練習をする。

例題：`hello, world`と10回表示する。

## for文

```
for (var i = 0; i < 10; ++i) {
  console.log(`hello, world`);
}
```

フローチャートを描いてみる。

## ループ変数の利用

1から10の和を求める

```
var sum = 0;
for (var i = 1; i <= 10; ++i) {
  sum = sum + i;//sum += iでもよい
}
console.log(i);
```

## 配列に関するループ

```
var データ = ['風', '林', '火', '山'];

console.log('0番目は' + データ[0] + 'です。');
console.log('1番目は' + データ[1] + 'です。');
console.log('2番目は' + データ[2] + 'です。');
console.log('3番目は' + データ[3] + 'です。');
```

これを次のように書く。

```
for (var i = 0; i < データ.length; ++i) {
  console.log(i + '番目は' + データ[i] + 'です。');
}
```

# 筋の配列

チェックすべき筋を配列にまとめておく。

```
var 筋の配列 = [
  [0, 1, 2], [3, 4, 5], [6, 7, 8], [0, 3, 6],
  [1, 4, 7], [2, 5, 8], [0, 4, 8], [2, 4, 6]];
var 筋の数 = 筋の配列.length;
```

そろったかどうかを次のようにチェックできるようになる。

```
function そろった場所を目立たせる() {
  for (var i = 0; i < 筋の数; ++i) {
    var 結果 = そろったか(筋の配列[i]);
    if (結果 !== 0) {
      $('div').addClass('終');
      筋に勝印を付ける(筋の配列[i]);
    }
  }
}
```

`クリックへの対応`の最後でこの関数を呼び出す。

```
  そろった場所を目立たせる();
```

# ランダムマルバツ

## 乱数

JavaScriptには，0以上1未満の乱数を返す`Math.random()`が用意されている。

これと，小数点以下を切り捨てる`Math.floor`を組み合わせると，利用して0からnまでの整数を得られるようになる（コンソールで試してみよう）。

```
console.log(Math.floor(Math.random() * 9));
```

## COMとの対戦

ゲームの流れは次のようになる。

1. 人が一手進める。
1. 勝敗が決まったかどうかをチェックする。決まったら終わり。
1. COMが一手進める。
1. 勝敗が決まったかどうかをチェックする。決まったら終わり。
1. 1に戻る。

`index.html`の`クリックへの対応`を`人が一手進める`に置換する。

### 手番の記憶

```
var 人 = 1;//先手ということ
var COM = -1;//後手ということ
```

### 人が一手進める

```
function 人が一手進める(位置) {
  盤面[位置] = 人;
  if (人 == 1) {
    $('#セル' + 位置).addClass('○');
  } else {
    $('#セル' + 位置).addClass('×');
  }
  そろった場所を目立たせる();
  COMが一手進める();
}
```

### COMが一手進める

`セル数`を記憶しておく（グローバル変数）。

```
var セル数 = 盤面.length;
```

```
function COMが一手進める() {
  while (true) {
    var 位置 = Math.floor(Math.random() * セル数);
    if (盤面[位置] === 0) {//埋められるまで繰り返す
      盤面[位置] = COM;
      if (COM == 1) {
        $('#セル' + 位置).addClass('○');
      } else {
        $('#セル' + 位置).addClass('×');
      }
      break;
    }
  }
  そろった場所を目立たせる();
}
```

### ゲーム開始時に先手・後手をランダムに決める
